# Contributing to WasmHub

Thank you for your interest in contributing! This project aims to be community-driven.

## ğŸ“ Project Structure

```sh
wasmhub/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib.rs                       # ğŸ“¦ Library code
â”‚   â””â”€â”€ bin/
â”‚       â””â”€â”€ wasmhub.rs               # ğŸ”§ CLI binary (feature-gated)
â”‚
â”œâ”€â”€ runtimes/                        # ğŸ“ Runtime sources and manifests
â”‚   â””â”€â”€ go/
â”‚       â”œâ”€â”€ main.go                  # Source file
â”‚       â”œâ”€â”€ manifest.json            # Version metadata
â”‚       â””â”€â”€ *.wasm                   # Built binaries (gitignored)
â”‚
â”œâ”€â”€ scripts/                         # ğŸ”§ Build scripts
â”‚   â”œâ”€â”€ build-all.sh                 # Build all runtimes
â”‚   â”œâ”€â”€ build-go.sh                  # Build Go runtime
â”‚   â”œâ”€â”€ build-rust.sh                # Build Rust runtime
â”‚   â”œâ”€â”€ generate-metadata.sh         # Generate manifest.json
â”‚   â””â”€â”€ verify-binary.sh             # Verify WASM binary
â”‚
â”œâ”€â”€ .github/workflows/
â”‚   â”œâ”€â”€ ci.yml                       # âœ… CI pipeline (tests, lint, format)
â”‚   â””â”€â”€ release.yml                  # ğŸ“¦ Release workflow (builds WASM + CLI)
â”‚
â”œâ”€â”€ Cargo.toml                       # ğŸ“¦ Package manifest
â”œâ”€â”€ Dockerfile                       # ğŸ³ Build environment for WASM
â”œâ”€â”€ justfile                         # ğŸ› ï¸ Build commands
â”œâ”€â”€ README.md                        # ğŸ“– User-facing docs
â”œâ”€â”€ CONTRIBUTING.md                  # ğŸ‘¥ This file
â”œâ”€â”€ LICENSE                          # âš–ï¸ MIT License
â””â”€â”€ .gitignore                       # ğŸš« Git ignore rules
```

The project is a single Rust crate with:
- **Library API** (`src/lib.rs`) - Can be used programmatically
- **CLI tool** (`src/bin/wasmhub.rs`) - Enabled with `--features cli`

## ğŸš€ Ways to Contribute

1. **Report Bugs** - Open an issue with reproduction steps
2. **Request Features** - Suggest new runtimes or improvements
3. **Submit PRs** - Fix bugs, add runtimes, improve docs
4. **Improve Documentation** - Help others understand the project
5. **Share** - Star the repo, tell others about it

## ğŸ”§ Development Setup

### Prerequisites

- Rust 1.85+ (`rustup install stable`)
- Git
- Just (optional, for convenient build commands: `cargo install just`)

### Clone & Build

```sh
# Clone repository
git clone https://github.com/anistark/wasmhub.git
cd wasmhub

# Build library only
cargo build

# Build library + CLI
cargo build --features cli

# Run tests
cargo test

# Run CLI locally
cargo run --features cli -- --help

# Install CLI globally
cargo install --path . --features cli
```

## ğŸ“ Code Style

```sh
# Format code
just format

# Lint code
just lint

# Auto-fix linting issues
just lint-fix
```

All PRs must pass formatting and linting checks.

## ğŸ§ª Testing

Write tests for all new features:

```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_language_from_str() {
        assert_eq!(Language::from_str("nodejs"), Some(Language::NodeJs));
        assert_eq!(Language::from_str("unknown"), None);
    }
}
```

Run tests:
```sh
cargo test
```

## ğŸ“¦ Adding a New Runtime

WASM binaries are **not** committed to the repository. They are built by CI and published as GitHub Release assets.

### Steps to Add a New Runtime

1. **Create the source directory**: `runtimes/<language>/`
2. **Add the source file** (e.g., `main.go`, `lib.rs`)
3. **Create a build script**: `scripts/build-<language>.sh`
4. **Update `scripts/build-all.sh`** to include your language
5. **Add to `Language` enum** in `src/runtime.rs`
6. **Write tests**
7. **Update README.md** with the new runtime
8. **Submit PR**

Example for adding Java:
```sh
# Create runtime directory with source
mkdir -p runtimes/java
# Add source file (e.g., Main.java)

# Create build script
cat > scripts/build-java.sh << 'EOF'
#!/usr/bin/env bash
# Build Java to WASM using TeaVM or similar
EOF
chmod +x scripts/build-java.sh

# Update build-all.sh to include Java builds
# Update Language enum in src/runtime.rs
git commit -am "Add Java runtime support"
```

### Runtime Directory Structure

```sh
runtimes/
â”œâ”€â”€ go/
â”‚   â”œâ”€â”€ main.go           # Source file (committed)
â”‚   â”œâ”€â”€ manifest.json     # Generated by build (committed)
â”‚   â””â”€â”€ go-1.23.wasm      # Built binary (gitignored, in releases)
â””â”€â”€ rust/
    â”œâ”€â”€ Cargo.toml        # Source (committed)
    â”œâ”€â”€ src/lib.rs        # Source (committed)
    â”œâ”€â”€ manifest.json     # Generated by build (committed)
    â””â”€â”€ rust-1.75.wasm    # Built binary (gitignored, in releases)
```

### Manifest Format

Each runtime has a `manifest.json` that describes available versions:

```json
{
    "language": "go",
    "latest": "1.23",
    "versions": {
        "1.23": {
            "file": "go-1.23.wasm",
            "size": 266712,
            "sha256": "efa1e13f39dfd3783d0eff5669088ab99a1ea1d38ac79f29b02e2ad8ddfea29d",
            "released": "2026-02-03T13:23:13Z",
            "wasi": "wasip1",
            "features": []
        }
    }
}
```

The manifest is auto-generated by `scripts/generate-metadata.sh` during the build process.

## ğŸ”„ CI/CD and Releases

### Continuous Integration

Every PR and push to `main` triggers CI checks:
- **Test**: Runs `cargo test` on Linux, macOS, and Windows
- **Format**: Checks code formatting with `cargo fmt`
- **Lint**: Runs `cargo clippy` for linting

### Release Process

When a GitHub Release is created:

1. **WASM runtimes are built** using the Docker build environment
2. **Manifests are generated** with checksums and metadata
3. **Binaries are uploaded** as release assets
4. **CLI binaries** are cross-compiled for all platforms

To create a release:
```sh
# Update version in Cargo.toml, then run:
just publish

# Or for GitHub release only (no crates.io):
just publish-github

# Or with explicit version:
just release 0.2.0
```

### Build Environment

WASM runtimes are built in a Docker container with:
- WASI SDK (for C/C++ compilation)
- TinyGo (for Go compilation)
- Rust with `wasm32-wasip1` target
- `wasm-opt` for binary optimization

To build locally:
```sh
# Using Docker (recommended)
just docker-build          # Build the Docker image
just docker-build-runtimes # Build all WASM runtimes

# Or install dependencies natively and run
./scripts/build-all.sh
```

---

## ğŸ› Reporting Bugs

Open an issue with:
- **Description** - What went wrong?
- **Steps to reproduce**
- **Expected behavior**
- **Actual behavior**
- **Environment** - OS, Rust version, etc.

## ğŸ’¡ Feature Requests

Open an issue with:
- **Use case** - Why is this needed?
- **Proposed solution**
- **Alternatives considered**

## ğŸ”€ Pull Request Process

1. **Fork** the repository
2. **Create a branch** - `git checkout -b feature/my-feature`
3. **Make changes** - Follow code style
4. **Write tests** - Ensure coverage
5. **Update docs** - If needed
6. **Commit** - Use clear commit messages
7. **Push** - `git push origin feature/my-feature`
8. **Open PR** - Fill out the template

### PR Checklist

- [ ] Code follows Rust style guide (`cargo fmt`)
- [ ] No clippy warnings (`cargo clippy`)
- [ ] Tests added and passing (`cargo test`)
- [ ] Documentation updated
- [ ] CHANGELOG.md updated (if applicable)

## ğŸ“œ Commit Messages

Use conventional commits:

```
feat: add Java runtime support
fix: correct cache path on Windows
docs: update CLI usage examples
test: add integration tests for loader
chore: update dependencies
```

## ğŸ·ï¸ Issue Labels

- `good-first-issue` - Great for newcomers
- `help-wanted` - Need community help
- `bug` - Something isn't working
- `enhancement` - New feature request
- `documentation` - Docs improvements

## âš–ï¸ Code of Conduct

Be respectful, inclusive, and collaborative. We're building this together.

## ğŸ“ Questions?

- Open a [Discussion](https://github.com/anistark/wasmhub/discussions)
- Ask on Discord (coming soon)
- Email: ani@anistark.com

## ğŸ’¡ Quick Reference

### Common Commands

Using justfile (recommended):

```sh
# Show all available commands
just --list

# Format code
just format

# Lint code
just lint

# Auto-fix lint issues
just lint-fix

# Check compilation
just check

# Build library
just build

# Build with all features
just build-all

# Run tests
just test

# Run all CI checks locally
just ci

# Install CLI globally
just install
```

Or using cargo directly:

```sh
# Build everything (library + CLI)
cargo build --all-features

# Run all tests
cargo test

# Format code
cargo fmt --all

# Lint code
cargo clippy --all-features

# Run CLI locally
cargo run --features cli -- list

# Check documentation
cargo doc --open

# Build release binary
cargo build --release --features cli
```

### Project Layout

- **src/lib.rs** - Public API for the library
- **src/bin/wasmhub.rs** - CLI application code
- **runtimes/** - Downloaded WASM runtime binaries
- **Cargo.toml** - Package manifest with `cli` feature flag

### Feature Flags

- **default** - Library only, no CLI
- **cli** - Includes CLI binary with `clap` argument parsing

Thank you for contributing! ğŸ‰
